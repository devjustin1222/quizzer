<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quizzer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --surface: #0f172a;
      --card: #111827;
      --accent: #a855f7;
      --accent-2: #22d3ee;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --correct: #22c55e;
      --incorrect: #ef4444;
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
      --radius: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(168, 85, 247, 0.2), transparent 35%),
                  radial-gradient(circle at 80% 0%, rgba(34, 211, 238, 0.25), transparent 30%),
                  radial-gradient(circle at 50% 100%, rgba(34, 211, 238, 0.15), transparent 25%),
                  #0b1120;
      color: var(--text);
      min-height: 100vh;
      padding: 24px;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto 48px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.02em;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 10px 14px;
      border-radius: 999px;
      color: var(--muted);
      font-weight: 600;
      box-shadow: var(--shadow);
    }

    .layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
    }

    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
    }

    .panel, .card {
      background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }

    .panel h2, .card h2 {
      margin-top: 0;
      font-size: 18px;
      letter-spacing: -0.01em;
    }

    .upload-box {
      border: 1px dashed rgba(255, 255, 255, 0.3);
      border-radius: var(--radius);
      padding: 16px;
      text-align: center;
      background: rgba(0,0,0,0.25);
      transition: border-color 150ms ease, transform 150ms ease;
    }

    .upload-box:hover {
      border-color: var(--accent-2);
      transform: translateY(-2px);
    }

    .upload-box input {
      width: 100%;
      cursor: pointer;
    }

    .toggle-group {
      display: flex;
      gap: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 999px;
      padding: 6px;
      width: fit-content;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .toggle {
      position: relative;
    }

    .toggle input {
      display: none;
    }

    .toggle label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 14px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--muted);
      font-weight: 600;
      transition: color 120ms ease, background 120ms ease;
    }

    .toggle input:checked + label {
      background: linear-gradient(120deg, rgba(168,85,247,0.6), rgba(34,211,238,0.6));
      color: #0b1120;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.02em;
    }

    .card {
      position: relative;
      overflow: hidden;
    }

    .question-number {
      color: var(--muted);
      font-weight: 600;
      margin-bottom: 6px;
    }

    .question-text {
      font-size: 20px;
      margin: 6px 0 16px;
      letter-spacing: -0.01em;
    }

    .options {
      display: grid;
      gap: 10px;
      margin: 10px 0 20px;
    }

    .option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255,255,255,0.03);
      cursor: pointer;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
    }

    .option .bubble {
      height: 28px;
      width: 28px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.2);
      display: grid;
      place-items: center;
      font-weight: 700;
      color: var(--muted);
    }

    .option:hover { transform: translateY(-1px); border-color: rgba(168, 85, 247, 0.6); }

    .option.selected { border-color: var(--accent); background: rgba(168, 85, 247, 0.08); }
    .option.selected .bubble { border-color: var(--accent); color: var(--text); }

    .option.correct { border-color: var(--correct); background: rgba(34,197,94,0.08); }
    .option.incorrect { border-color: var(--incorrect); background: rgba(239,68,68,0.08); }

    .actions { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }

    button {
      border: none;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: -0.01em;
      border-radius: 12px;
      padding: 12px 16px;
      transition: transform 120ms ease, filter 120ms ease;
    }

    button.primary {
      background: linear-gradient(120deg, #a855f7, #22d3ee);
      color: #0b1120;
      box-shadow: var(--shadow);
    }

    button.secondary {
      background: rgba(255,255,255,0.08);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    button:disabled { opacity: 0.5; cursor: not-allowed; }
    button:not(:disabled):active { transform: translateY(1px); filter: brightness(0.95); }

    .status {
      margin-top: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status .pill { padding: 8px 12px; }

    .progress {
      height: 10px;
      background: rgba(255,255,255,0.08);
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress div {
      height: 100%;
      background: linear-gradient(120deg, #a855f7, #22d3ee);
      width: 0;
      transition: width 200ms ease;
    }

    .summary {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    .summary-item {
      padding: 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .summary-item h4 { margin: 0 0 6px; }
    .muted { color: var(--muted); }

    .empty-state {
      text-align: center;
      padding: 24px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,0.2);
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Quizzer</h1>
      <span class="pill">Upload CSV · Pick a mode · Quiz away</span>
    </header>

    <div class="layout">
      <section class="panel" aria-label="Quiz controls">
        <h2>Setup</h2>
        <p class="muted">Upload a CSV with columns: <strong>question</strong>, <strong>option1..option4</strong> (or <strong>option_a..option_d</strong>), and <strong>answer/correct</strong> (letter or text). Data stays in your browser.</p>
        <div class="upload-box">
          <input type="file" id="fileInput" accept=".csv" />
          <p class="muted" style="margin:8px 0 0">Drop or choose a CSV to replace questions.</p>
        </div>

        <h3>Quiz mode</h3>
        <div class="toggle-group" role="radiogroup" aria-label="Quiz mode">
          <div class="toggle">
            <input type="radio" name="mode" id="modeInstant" value="instant" checked>
            <label for="modeInstant">Instant feedback</label>
          </div>
          <div class="toggle">
            <input type="radio" name="mode" id="modeFinal" value="final">
            <label for="modeFinal">Final score</label>
          </div>
        </div>

        <div style="margin-top:16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <button class="primary" id="startBtn">Start quiz</button>
          <button class="secondary" id="sampleBtn" type="button">Use sample quiz</button>
          <span class="badge" id="questionCount">0 questions loaded</span>
        </div>
      </section>

      <section class="card" aria-live="polite">
        <div id="quizArea"></div>
      </section>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const quizArea = document.getElementById('quizArea');
    const questionCount = document.getElementById('questionCount');
    const startBtn = document.getElementById('startBtn');
    const modeRadios = document.querySelectorAll('input[name="mode"]');

    let questions = [];
    let responses = [];
    let currentIndex = 0;
    let statusState = { message: '', type: 'info' };

    const sampleCSV = `question,option_a,option_b,option_c,option_d,correct\nWhat does HTML stand for?,Hyper Trainer Marking Language,Hyper Text Markup Language,Hyper Text Marketing Language,Hyper Text Markup Leveler,B\nWhich method converts JSON to JavaScript object?,JSON.parse(),JSON.stringify(),JSON.toJS(),JSON.convert(),A\nHow many bits make up an IPv6 address?,32 bits,64 bits,128 bits,256 bits,C\nWhich CSS property changes text color?,font-style,text-decoration,color,text-shadow,C`;

    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      if (lines.length === 0) return [];
      const headers = lines[0].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(h => h.trim().toLowerCase());
      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const row = lines[i];
        if (!row.trim()) continue;
        const cols = row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.trim().replace(/^"|"$/g, ''));
        const record = {};
        headers.forEach((h, idx) => record[h] = cols[idx] ?? '');
        const optionKeys = Object.keys(record).filter(k => k.startsWith('option'));
        const options = optionKeys.map(k => record[k]).filter(Boolean);
        const answerRaw = record['answer'] || record['correct'] || record['correct_answer'] || '';
        const answerIndex = parseAnswer(answerRaw, options);
        if (!record.question || options.length === 0 || answerIndex === -1) continue;
        data.push({ question: record.question, options, answerIndex });
      }
      return data;
    }

    function parseAnswer(value, options) {
      if (!value) return -1;
      const letter = value.trim().toUpperCase();
      const letterIndex = letter.charCodeAt(0) - 65;
      if (letterIndex >= 0 && letterIndex < options.length && /^[A-Z]$/.test(letter)) return letterIndex;
      const byText = options.findIndex(opt => opt.toLowerCase() === value.trim().toLowerCase());
      return byText;
    }

    function setQuestions(newQuestions) {
      questions = newQuestions;
      questionCount.textContent = `${questions.length} question${questions.length === 1 ? '' : 's'} loaded`;
      resetQuiz();
      renderEmptyState();
    }

    function resetQuiz() {
      responses = questions.map(() => ({ selected: null, checked: false }));
      currentIndex = 0;
      statusState = { message: '', type: 'info' };
    }

    function getMode() {
      return document.querySelector('input[name="mode"]:checked').value;
    }

    function renderEmptyState(message = 'Upload a CSV to begin or use the sample set.') {
      quizArea.innerHTML = `<div class="empty-state">${message}</div>`;
    }

    function renderQuestion() {
      if (!questions.length) {
        renderEmptyState();
        return;
      }
      const q = questions[currentIndex];
      const response = responses[currentIndex];
      const mode = getMode();
      const progress = ((currentIndex) / questions.length) * 100;

      quizArea.innerHTML = `
        <div class="progress" aria-hidden="true"><div style="width:${progress}%"></div></div>
        <div class="question-number">Question ${currentIndex + 1} of ${questions.length}</div>
        <div class="question-text">${q.question}</div>
        <div class="options" role="list">
          ${q.options.map((opt, idx) => {
            const letters = String.fromCharCode(65 + idx);
            let classes = 'option';
            if (response.selected === idx) classes += ' selected';
            if (mode === 'instant' && response.checked) {
              if (idx === q.answerIndex) classes += ' correct';
              else if (response.selected === idx && idx !== q.answerIndex) classes += ' incorrect';
            }
            return `<button type="button" class="${classes}" data-index="${idx}" role="listitem">
              <span class="bubble">${letters}</span>
              <span>${opt}</span>
            </button>`;
          }).join('')}
        </div>
        <div class="actions">
          <button class="secondary" id="prevBtn" ${currentIndex === 0 ? 'disabled' : ''}>Back</button>
          <button class="primary" id="nextBtn">${currentIndex === questions.length - 1 ? 'Finish' : 'Next'}</button>
          ${mode === 'instant' ? '<button class="secondary" id="checkBtn">Check answer</button>' : ''}
        </div>
        <div class="status" id="statusArea"></div>
      `;

      quizArea.querySelectorAll('.option').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = Number(btn.dataset.index);
          responses[currentIndex].selected = idx;
          if (mode === 'instant') {
            responses[currentIndex].checked = false;
          }
          setStatus('');
          renderQuestion();
        });
      });

      document.getElementById('prevBtn').onclick = () => moveTo(currentIndex - 1);
      document.getElementById('nextBtn').onclick = () => {
        if (mode === 'instant') {
          if (!response.checked) {
            setStatus('Please check your answer first.', 'warning');
            return;
          }
        } else {
          if (response.selected === null) {
            setStatus('Select an option to continue.', 'warning');
            return;
          }
        }
        if (currentIndex === questions.length - 1) {
          showResults();
        } else {
          moveTo(currentIndex + 1);
        }
      };

      if (mode === 'instant') {
        const checkBtn = document.getElementById('checkBtn');
        checkBtn.onclick = () => {
          if (response.selected === null) {
            setStatus('Choose an option to check.', 'warning');
            return;
          }
          responses[currentIndex].checked = true;
          const correct = response.selected === q.answerIndex;
          setStatus(correct ? 'Correct! Nice work.' : `Not quite. The correct answer is ${String.fromCharCode(65 + q.answerIndex)}.`, correct ? 'success' : 'error');
          renderQuestion();
        };
      }
      setStatus(statusState.message, statusState.type);
    }

    function setStatus(message, type = 'info') {
      statusState = { message, type };
      const statusArea = document.getElementById('statusArea');
      if (!statusArea) return;
      if (!message) { statusArea.innerHTML = ''; return; }
      const colors = {
        success: 'var(--correct)',
        error: 'var(--incorrect)',
        warning: '#f59e0b',
        info: 'var(--muted)'
      };
      statusArea.innerHTML = `<span class="pill" style="color:${colors[type] || 'var(--muted)'}">${message}</span>`;
    }

    function moveTo(index) {
      if (index < 0 || index >= questions.length) return;
      currentIndex = index;
      setStatus('');
      renderQuestion();
    }

    function calculateScore() {
      let correct = 0;
      responses.forEach((resp, idx) => {
        if (resp.selected === questions[idx].answerIndex) correct++;
      });
      return { correct, total: questions.length };
    }

    function showResults() {
      const { correct, total } = calculateScore();
      const mode = getMode();
      const summaryItems = questions.map((q, idx) => {
        const resp = responses[idx];
        const isCorrect = resp.selected === q.answerIndex;
        const selection = resp.selected != null ? q.options[resp.selected] : 'Not answered';
        return `<div class="summary-item">
          <h4>Q${idx + 1}: ${q.question}</h4>
          <div class="muted">Your pick: ${selection}</div>
          <div style="color:${isCorrect ? 'var(--correct)' : 'var(--incorrect)'}; font-weight:700;">${isCorrect ? 'Correct' : 'Correct answer: ' + q.options[q.answerIndex]}</div>
        </div>`;
      }).join('');

      quizArea.innerHTML = `
        <div class="question-text">${mode === 'instant' ? 'Quiz complete!' : 'Results ready.'}</div>
        <div class="pill" style="color:var(--text); background: rgba(255,255,255,0.06);">Score: ${correct}/${total} (${Math.round((correct/total)*100)}%)</div>
        <div class="summary">${summaryItems}</div>
        <div class="actions" style="margin-top:16px;">
          <button class="primary" id="restartBtn">Restart</button>
        </div>
      `;

      document.getElementById('restartBtn').onclick = () => {
        resetQuiz();
        renderQuestion();
      };
    }

    fileInput.addEventListener('change', (event) => {
      const file = event.target.files?.[0];
      if (!file) return;
      file.text().then(text => {
        const parsed = parseCSV(text);
        if (!parsed.length) {
          renderEmptyState('Could not find valid questions in this file.');
          questionCount.textContent = '0 questions loaded';
          return;
        }
        setQuestions(parsed);
        setStatus('Questions loaded! Press start when you are ready.', 'success');
        renderQuestion();
      });
    });

    startBtn.addEventListener('click', () => {
      if (!questions.length) {
        setStatus('Add a CSV or load the sample quiz first.', 'warning');
        renderEmptyState('Upload a CSV to begin.');
        return;
      }
      resetQuiz();
      setStatus('');
      renderQuestion();
    });

    document.getElementById('sampleBtn').addEventListener('click', () => {
      setQuestions(parseCSV(sampleCSV));
      setStatus('Sample quiz loaded. Press start when you are ready.', 'info');
      renderQuestion();
    });

    modeRadios.forEach(r => r.addEventListener('change', () => {
      resetQuiz();
      setStatus('');
      renderQuestion();
    }));

    renderEmptyState('Upload a CSV to begin or use the sample quiz.');
  </script>
</body>
</html>
